# Mail Server Operations Blueprint

> Operational strategy for managing local SMTP relay components.

## 1. Description

The Communication stack (`infra/10-communication/mail/docker-compose.yml`) provides SMTP relay and mailbox utilities for applications that require sending verification emails or alert notifications natively within the `infra_net` boundary.

## 2. SMTP Configurations

Applications within `infra_net` (e.g. Keycloak or Grafana AlertManager) should point to the internal Mail relay using:

- **Host**: `mail` (Internal DNS generated by container name)
- **Port**: Typically `1025` or `25` depending on relay implementation.
- **TLS**: Usually disabled for local internal Docker bridged traffic.

## 3. Webmail Dashboard

Most local docker testing mail environments (like standard Mailpit or Mailhog) feature a GUI.

- **Access**: `https://mail.${DEFAULT_URL}`
- **Usage**: Use this dashboard to inspect outgoing HTML templates, test links, and verify that DKIM/SPF signages remain intact if mocking production configurations.

## 4. Troubleshooting Dropped Mail

If Grafana Alertmanager or Keycloak logs indicate failed connection to the SMTP server:

1. Verify `infra_net` visibility.
2. Check if the internal port mapping matches the environment variables injected into the requesting container.

```bash
docker exec -it infra-alertmanager nc -zv mail 1025
```

1. Read the logs under the mail container for potential authentication rejections.
