networks:
  infra_net:
    name: infra_net
    driver: bridge
    ipam:
      config:
        - subnet: ${INFRA_SUBNET:-172.19.0.0/16}
          gateway: ${INFRA_GATEWAY:-172.19.0.1}
  project_net:
    external: true
  kind:
    external: true

secrets:
  # ── Common ─────────────────────────────────────────────
  smtp_password:
    file: ./secrets/common/smtp_password.txt
  slack_webhook:
    file: ./secrets/common/slack_webhook.txt
  smtp_username:
    file: ./secrets/common/smtp_username.txt

  # ── Gateway ─────────────────────────────────────────────
  traefik_basicauth_password:
    file: ./secrets/auth/traefik_basicauth_password.txt
  traefik_opensearch_basicauth_password:
    file: ./secrets/auth/traefik_opensearch_basicauth_password.txt

  # ── Auth ────────────────────────────────────────────────
  keycloak_admin_password:
    file: ./secrets/auth/keycloak_admin_password.txt
  oauth2_proxy_client_secret:
    file: ./secrets/auth/oauth2_proxy_client_secret.txt
  oauth2_proxy_cookie_secret:
    file: ./secrets/auth/oauth2_proxy_cookie_secret.txt

  # ── Observability ───────────────────────────────────────
  grafana_admin_password:
    file: ./secrets/observability/grafana_admin_password.txt

  # ── PostgreSQL ─────────────────────────────────────
  service_postgres_password:
    file: ./secrets/db/postgres/service_password.txt
  mng_postgres_password:
    file: ./secrets/db/postgres/mng_password.txt
  keycloak_db_password:
    file: ./secrets/db/postgres/keycloak_password.txt
  airflow_db_password:
    file: ./secrets/db/postgres/airflow_password.txt
  n8n_db_password:
    file: ./secrets/db/postgres/n8n_password.txt
  sonarqube_db_password:
    file: ./secrets/db/postgres/sonarqube_password.txt
  terrakube_db_password:
    file: ./secrets/db/postgres/terrakube_password.txt
  supabase_db_password:
    file: ./secrets/db/postgres/supabase_password.txt

  # ── PostgreSQL (Patroni / Spilo) ───────────────────────
  patroni_superuser_password:
    file: ./secrets/db/postgres/patroni_superuser_password.txt
  patroni_replication_password:
    file: ./secrets/db/postgres/patroni_replication_password.txt
  # ── Cassandra ───────────────────────────────────────────
  cassandra_password:
    file: ./secrets/db/cassandra/cassandra_password.txt
  # ── MongoDB ─────────────────────────────────────────────
  mongodb_root_password:
    file: ./secrets/db/mongodb/mongodb_root_password.txt
  mongo_express_basicauth_password:
    file: ./secrets/db/mongodb/mongo_express_basicauth_password.txt
  # ── Neo4j ───────────────────────────────────────────────
  neo4j_password:
    file: ./secrets/db/neo4j/neo4j_password.txt
  # ── Valkey / Redis ─────────────────────────────────────
  n8n_valkey_password:
    file: ./secrets/db/valkey/n8n_password.txt
  service_valkey_password:
    file: ./secrets/db/valkey/service_password.txt
  mng_valkey_password:
    file: ./secrets/db/valkey/mng_password.txt
  oauth2_valkey_password:
    file: ./secrets/db/valkey/oauth2_password.txt
  terrakube_valkey_password:
    file: ./secrets/db/valkey/terrakube_password.txt
  airflow_valkey_password:
    file: ./secrets/db/valkey/airflow_password.txt
  # ── MinIO ───────────────────────────────────────────────
  minio_root_password:
    file: ./secrets/storage/minio_root_password.txt
  minio_root_username:
    file: ./secrets/storage/minio_root_username.txt
  minio_app_user_password:
    file: ./secrets/storage/minio_app_user_password.txt
  minio_app_username:
    file: ./secrets/storage/minio_app_username.txt

  # ── OpenSearch ──────────────────────────────────────────
  opensearch_admin_password:
    file: ./secrets/data/opensearch_admin_password.txt
  opensearch_dashboard_password:
    file: ./secrets/data/opensearch_dashboard_password.txt
  opensearch_exporter_password:
    file: ./secrets/data/opensearch_exporter_password.txt

  # ── Workflow: Airflow ───────────────────────────────────
  airflow_fernet_key:
    file: ./secrets/automation/airflow_fernet_key.txt
  airflow_www_password:
    file: ./secrets/automation/airflow_www_password.txt

  # ── Workflow: n8n ───────────────────────────────────────
  n8n_encryption_key:
    file: ./secrets/automation/n8n_encryption_key.txt
  n8n_runner_auth_token:
    file: ./secrets/automation/n8n_runner_auth_token.txt

  # ── Tooling: SonarQube ──────────────────────────────────
  sonarqube_admin_password:
    file: ./secrets/tools/sonarqube_admin_password.txt

  # ── Tooling: Terrakube ──────────────────────────────────
  terrakube_pat_secret:
    file: ./secrets/tools/terrakube_pat_secret.txt
  terrakube_internal_secret:
    file: ./secrets/tools/terrakube_internal_secret.txt
  # ── Tooling: Syncthing ──────────────────────────────────
  syncthing_password:
    file: ./secrets/tools/syncthing_password.txt

  # ── Data: Supabase ──────────────────────────────────────
  supabase_jwt_secret:
    file: ./secrets/data/supabase_jwt_secret.txt
  supabase_anon_key:
    file: ./secrets/data/supabase_anon_key.txt
  supabase_service_key:
    file: ./secrets/data/supabase_service_key.txt
  supabase_dashboard_password:
    file: ./secrets/data/supabase_dashboard_password.txt
  supabase_secret_key_base:
    file: ./secrets/data/supabase_secret_key_base.txt
  supabase_vault_enc_key:
    file: ./secrets/data/supabase_vault_enc_key.txt
  supabase_pg_meta_crypto_key:
    file: ./secrets/data/supabase_pg_meta_crypto_key.txt

  # ── InfluxDB ─────────────────────────────────────────────
  influxdb_password:
    file: ./secrets/db/influxdb/influxdb_password.txt
  influxdb_api_token:
    file: ./secrets/db/influxdb/influxdb_api_token.txt

  # ── CouchDB ──────────────────────────────────────────────
  couchdb_password:
    file: ./secrets/db/couchdb/couchdb_password.txt
  couchdb_cookie:
    file: ./secrets/db/couchdb/couchdb_cookie.txt

include:
  # Core stack
  - infra/01-gateway/traefik/docker-compose.yml
  - infra/02-auth/keycloak/docker-compose.yml
  - infra/02-auth/oauth2-proxy/docker-compose.yml
  - infra/04-data/mng-db/docker-compose.yml
  - infra/04-data/minio/docker-compose.yml
  - infra/04-data/qdrant/docker-compose.yml
  - infra/04-data/postgresql-cluster/docker-compose.yml
  - infra/04-data/valkey-cluster/docker-compose.yml
  - infra/04-data/opensearch/docker-compose.yml
  - infra/05-messaging/kafka/docker-compose.yml
  # - infra/05-messaging/ksql/docker-compose.yml
  - infra/06-observability/docker-compose.yml
  # - infra/07-workflow/n8n/docker-compose.yml
  # Optional stacks (enabled via profiles)
  # - infra/01-gateway/nginx/docker-compose.yml
  # - infra/03-security/vault/docker-compose.yml
  # - infra/04-data/couchdb/docker-compose.yml
  # - infra/04-data/influxdb/docker-compose.yml
  # - infra/05-messaging/rabbitmq/docker-compose.yml
  # - infra/07-workflow/airflow/docker-compose.yml
  # - infra/08-ai/ollama/docker-compose.yml
  # - infra/08-ai/open-webui/docker-compose.yml
  # - infra/09-tooling/sonarqube/docker-compose.yml
  # - infra/09-tooling/terrakube/docker-compose.yml
  # - infra/10-communication/mail/docker-compose.yml
