# Hy-Home System Optimization Headers (Standardized)
x-security-baseline: &security-baseline
  security_opt:
    - no-new-privileges:true
  cap_drop:
    - ALL

x-logging: &default-logging
  driver: 'json-file'
  options:
    max-size: '5m'
    max-file: '2'

x-resource-low: &resource-low
  deploy:
    resources:
      limits: { cpus: '0.2', memory: 128M }
      reservations: { memory: 64M }

x-resource-med: &resource-med
  deploy:
    resources:
      limits: { cpus: '0.5', memory: 512M }
      reservations: { memory: 256M }

x-resource-high: &resource-high
  deploy:
    resources:
      limits: { cpus: '1.0', memory: 1G }
      reservations: { memory: 512M }

x-restart: &default-restart
  restart: unless-stopped
name: terraform

x-logging: &default-logging
  driver: 'json-file'
  options:
    max-size: '5m'
    max-file: '2'

services:
  terraform:
    image: hashicorp/terraform:1.14.4
    container_name: terraform
    restart: 'no' # 단발성 작업 컨테이너
    security_opt:
      - no-new-privileges:true
    cap_drop:
      - ALL
    volumes:
      - ./workspace:/workspace
      # - $HOME/.config/gcloud:/root/.config/gcloud:ro # Optional: For GCP Auth
      - $HOME/.aws:/root/.aws:ro # Optional: For AWS Auth (Read-Only)
      - $HOME/.azure:/root/.azure:ro # Optional: For Azure Auth (Read-Only)
    working_dir: /workspace
    entrypoint: ['terraform']
    networks:
      - infra_net
    logging: *default-logging
