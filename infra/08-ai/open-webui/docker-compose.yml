name: open-webui

volumes:
  ollama-webui:
    driver: local
    driver_opts:
      o: bind
      type: none
      device: ${DEFAULT_AI_MODEL_DIR}/open-webui

services:
  open-webui:
    extends:
      file: ../../../infra/common-optimizations.yml
      service: template-infra-med
    image: ghcr.io/open-webui/open-webui:v0.8.5-cuda
    container_name: open-webui
    environment:
      - OLLAMA_BASE_URL=http://ollama:${OLLAMA_PORT:-11434}
      - VECTOR_DB_URL=http://qdrant:${QDRANT_PORT:-6333}
      - RAG_EMBEDDING_ENGINE=ollama
      - RAG_EMBEDDING_MODEL=qwen3-embedding:0.6b
    volumes:
      - ollama-webui:/app/backend/data
    networks:
      - infra_net
    labels:
      traefik.enable: 'true'
      traefik.http.routers.open-webui.rule: Host(`chat.${DEFAULT_URL}`)
      traefik.http.routers.open-webui.entrypoints: websecure
      traefik.http.routers.open-webui.tls: 'true'
      traefik.http.services.open-webui.loadbalancer.server.port: 8080
    healthcheck:
      test: ['CMD-SHELL', 'curl -f http://localhost:8080/health || exit 1']
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 1m

networks:
  infra_net:
    name: infra_net
    external: true
