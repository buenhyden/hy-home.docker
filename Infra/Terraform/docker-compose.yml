version: '3.8'

services:
  terraform:
    # 공식 테라폼 이미지를 사용 (특정 버전을 명시하는 것이 좋습니다)
    image: hashicorp/terraform:1.9.0
    
    # 컨테이너 이름을 고정하여 관리 용이성 증대
    container_name: terraform_runner
    
    # 현재 디렉토리(.)를 컨테이너의 /workspace로 마운트
    volumes:
      - ./:/workspace
      # (선택) 로컬의 AWS 자격 증명을 공유하고 싶다면 아래 주석 해제 (보안 주의)
      # - ~/.aws:/root/.aws
    
    # 작업 디렉토리 설정
    working_dir: /workspace
    
    # 환경 변수 전달 (AWS, Azure, GCP 키 등)
    environment:
      - AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID}
      - AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}
      - AWS_DEFAULT_REGION=ap-northeast-2
      # 테라폼 로그 레벨 설정 (디버깅용)
      - TF_LOG=INFO