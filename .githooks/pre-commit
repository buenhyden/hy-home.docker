#!/usr/bin/env sh
set -e

ROOT_DIR="$(git rev-parse --show-toplevel)"
cd "$ROOT_DIR"

STAGED_FILES="$(git diff --cached --name-only --diff-filter=ACMR)"

if echo "$STAGED_FILES" | grep -q '^projects/storybook/react-js/'; then
  if [ ! -d "projects/storybook/react-js/node_modules" ]; then
    echo "react-js: node_modules not found. Run npm install in projects/storybook/react-js."
    exit 1
  fi
  (cd projects/storybook/react-js && npm run lint && npm run format:check && npm run markdownlint)
fi

if echo "$STAGED_FILES" | grep -q '^projects/storybook/react-ts/'; then
  if [ ! -d "projects/storybook/react-ts/node_modules" ]; then
    echo "react-ts: node_modules not found. Run npm install in projects/storybook/react-ts."
    exit 1
  fi
  (cd projects/storybook/react-ts && npm run lint && npm run format:check && npm run markdownlint)
fi
